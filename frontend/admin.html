<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Admin</title><link rel="stylesheet" href="styles.css"></head><body>
<header><div class="logo">Admin Dashboard</div><nav class="nav"><a href="/admin-checkin.html">검표</a></nav></header>
<main style="padding:24px; display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(320px,1fr));">
  <section class="card"><h3>공연글 생성</h3>
    <form id="showForm"><input name="title" placeholder="제목"><textarea name="content" placeholder="내용"></textarea><input name="posterUrl" placeholder="포스터 URL"><button class="btn">등록</button></form>
    <div id="showMsg"></div>
  </section>
  <section class="card"><h3>이벤트 생성</h3>
    <form id="eventForm">
      <input name="title" placeholder="이벤트명">
      <input name="showPostId" placeholder="연결 쇼 ID">
      <input name="startAt" placeholder="UTC ISO (예: 2024-12-01T12:00:00Z)">
      <input name="venue" placeholder="장소">
      <input name="price" type="number" placeholder="가격">
      <input name="totalStock" type="number" placeholder="총재고">
      <button class="btn">등록</button>
    </form><div id="eventMsg"></div>
  </section>
  <section class="card"><h3>예매 현황</h3><button class="btn" onclick="loadBookings()">새로고침</button><div id="bookings"></div></section>
  <section class="card"><h3>티켓 목록</h3><button class="btn" onclick="loadTickets()">새로고침</button><div id="tickets"></div></section>
</main>
<script src="js/api.js"></script>
<script>
showForm.onsubmit=async e=>{e.preventDefault(); const fd=new FormData(showForm);
  try{ await apiPost('/admin/shows',{title:fd.get('title'),content:fd.get('content'),posterUrl:fd.get('posterUrl')}); showMsg.textContent='등록'; }
  catch(err){ showMsg.textContent=err.error||'실패'; } };
eventForm.onsubmit=async e=>{e.preventDefault(); const fd=new FormData(eventForm);
  try{ await apiPost('/admin/events',{title:fd.get('title'),showPost:{id:Number(fd.get('showPostId'))||null},startAt:fd.get('startAt'),venue:fd.get('venue'),price:Number(fd.get('price')),totalStock:Number(fd.get('totalStock')),remainingStock:Number(fd.get('totalStock'))}); eventMsg.textContent='등록'; }
  catch(err){ eventMsg.textContent=err.error||'실패'; } };
async function loadBookings(){ const b=await apiGet('/admin/bookings'); bookings.innerHTML=b.map(x=>`<div>${x.id} ${x.event.title} x${x.quantity} (${x.user.email})</div>`).join(''); }
async function loadTickets(){ const t=await apiGet('/admin/tickets'); tickets.innerHTML=t.map(x=>`<div>${x.ticketCode} ${x.booking.event.title} ${x.checkedInAt?'checked':'pending'}</div>`).join(''); }
loadBookings(); loadTickets();
</script></body></html>

